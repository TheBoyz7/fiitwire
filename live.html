<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>FootWire | Live Scores</title>
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="css/lives.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
</head>
<body>

  <header class="site-header">
    <div class="container">
      <div class="logo"><h1>FootWire</h1></div>
      <nav class="main-nav">
        <ul>
          <li><a href="index.php">Home</a></li>
          <li><a href="news.php">News</a></li>
          <li><a href="league.html">Leagues</a></li>
          <li><a href="team.html">Teams</a></li>
          <li><a href="live.html">Live Scores</a></li>
        </ul>
      </nav>
      <div class="auth-buttons">
        <button class="login-btn">Login</button>
        <button class="signup-btn">Sign Up</button>
      </div>
    </div>
  </header>

  <div class="score-tabs container" id="scoreTabs"></div>
  <section class="live-matches container" id="matchList"></section>

  <script>
    // --- Helper Functions ---
    function formatDateRelative(offset) {
      const d = new Date();
      d.setDate(d.getDate() + offset);
      return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }
    function getDateString(offset = 0) {
      const d = new Date();
      d.setDate(d.getDate() + offset);
      return d.toISOString().split('T')[0];
    }

    // --- Build Tabs ---
    const daysToRender = [{ label: 'Yesterday', offset: -1 }, { label: 'Today', offset: 0 }, { label: 'Tomorrow', offset: 1 }];
    for (let i = 2; i <= 20; i++) daysToRender.unshift({ label: formatDateRelative(-i), offset: -i });
    for (let i = 2; i <= 20; i++) daysToRender.push({ label: formatDateRelative(i), offset: i });

    const scoreTabs = document.getElementById('scoreTabs');
    daysToRender.forEach(day => {
      const btn = document.createElement('button');
      btn.className = 'tab' + (day.offset === 0 ? ' active' : '');
      btn.innerText = day.label;
      btn.dataset.offset = day.offset;
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        btn.classList.add('active');
        fetchFixturesForOffset(day.offset);
      });
      scoreTabs.appendChild(btn);
    });

    // --- Main Logic ---
    const matchList = document.getElementById('matchList');
    async function fetchFixturesForOffset(offset) {
      const date = getDateString(offset);
      const url = `http://localhost:3000/api/fixtures?startDate=${date}&endDate=${date}`;
      matchList.innerHTML = ''; // clear
      try {
        const res = await fetch(url);
        const fixtures = await res.json();

        if (!fixtures.length) {
          matchList.innerHTML = `<p>No matches for ${formatDateRelative(offset)}.</p>`;
          return;
        }
        renderMatches(fixtures);
      } catch (err) {
        console.error('Error fetching fixtures:', err);
        matchList.innerHTML = '<p>NO MATCHES TODAY.</p>';
      }
    }
function renderMatches(matches) {
  matchList.innerHTML = '';

  matches.forEach(fixture => {
    const participants = fixture.participants || [];
    const home = participants.find(p => p.meta.location === 'home') || {};
    const away = participants.find(p => p.meta.location === 'away') || {};

    // üèüÔ∏è CURRENT scores
    const scores = fixture.scores?.filter(s => s.description === 'CURRENT') || [];
    const homeScoreRaw = scores.find(s => s.participant_id === home.id)?.score?.goals;
    const awayScoreRaw = scores.find(s => s.participant_id === away.id)?.score?.goals;
    const homeScore = Number.isFinite(homeScoreRaw) ? homeScoreRaw : '-';
    const awayScore = Number.isFinite(awayScoreRaw) ? awayScoreRaw : '-';

    // ‚è±Ô∏è Determine status text
    const minute = fixture.time?.minute;
    const statusName = (fixture.status?.name || '').toLowerCase();

    let statusText;
    if (minute != null) {
      // live play
      statusText = `${minute}‚Ä≤`;
    } else if (statusName.includes('half')) {
      // explicit half-time status
      statusText = 'HT';
    } else if (
      Number.isFinite(homeScoreRaw) ||
      Number.isFinite(awayScoreRaw)
    ) {
      // score exists, but no minute => match is finished
      statusText = 'FT';
    } else {
      // not started yet: kickoff time
      const kick = new Date(fixture.starting_at + 'Z');
      statusText = kick.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }

    const isLive = minute != null;

    // üÉè Build card link
    const cardLink = document.createElement('a');
    cardLink.href = `match.html?id=${fixture.id}`;
    cardLink.className = 'match-card-link';

    cardLink.innerHTML = `
      <div class="match-card">
        <div class="match-header">
          <span>${fixture.league?.name || ''}</span>
          <em class="status ${isLive ? 'live' : 'scheduled'}">${statusText}</em>
        </div>

        <div class="teams">
          <div class="team team--home">
            <a href="club.html?id=${home.id}" class="logo-link">
              <img src="${home.image_path || ''}" alt="${home.name}" class="team-logo">
            </a>
            <div class="team-name">${home.name || 'TBD'}</div>
          </div>

          <div class="score">
            <span>${homeScore}</span>
            <span class="vs">-</span>
            <span>${awayScore}</span>
          </div>

          <div class="team team--away">
            <a href="club.html?id=${away.id}" class="logo-link">
              <img src="${away.image_path || ''}" alt="${away.name}" class="team-logo">
            </a>
            <div class="team-name">${away.name || 'TBD'}</div>
          </div>
        </div>
      </div>
    `;

    // üö´ Prevent match link when clicking logos
    cardLink.querySelectorAll('.logo-link').forEach(link => {
      link.addEventListener('click', e => e.stopPropagation());
    });

    matchList.appendChild(cardLink);
  });
}

    // --- Initial Load for Today ---
    fetchFixturesForOffset(0);
  </script>

</body>
</html>
