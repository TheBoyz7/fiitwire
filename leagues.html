<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FootWire | Premier League Overview</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/leagues.css">
</head>
<body>

  <!-- Site Header -->
  <header class="site-header">
    <div class="container">
      <h1>FootWire ⚽ Premier League</h1>
      <nav class="main-nav">
        <ul>
          <li><a href="index.php">Home</a></li>
          <li><a href="news.php">News</a></li>
          <li><a href="league.html">Leagues</a></li>
          <li><a href="team.html">Teams</a></li>
          <li><a href="live.html">Live Scores</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <!-- League Banner -->
  <section class="league-banner">
    <div class="container">
      <img src="images/premier-league-logo-5F922E3/premier-league-logo.png" alt="Premier League Logo" class="league-logo">
      <div class="league-info">
        <h2>Premier League</h2>
        <p class="league-description">England’s top-flight competition featuring 20 clubs battling for glory.</p>
      </div>
    </div>
  </section>

  <!-- Primary Tabs -->
  <nav class="league-tabs container">
    <button class="tab-btn active" data-tab="overview">Overview</button>
    <button class="tab-btn" data-tab="standings">Standings</button>
    <button class="tab-btn" data-tab="fixtures">Fixtures</button>
    <button class="tab-btn" data-tab="form">Form</button>
    <button class="tab-btn" data-tab="statistics">Statistics</button>
    <button class="tab-btn" data-tab="news">News</button>
  </nav>

  <!-- Tab Contents -->
  <main class="league-content container">

    <!-- Overview -->
    <section id="overview" class="tab-content active">
     <div class="overview-widgets">
  <div class="overview-video">
    <h4>Weekly League News</h4>
    <div class="video-container"><!-- iframe injected here --></div>
  </div>

  <div class="overview-fixtures">
    <br>
    <h4>Upcoming Fixtures</h4>
    <ul class="fixtures-preview">
      <!-- JS will insert <li>Team A vs Team B — Time</li> here -->
       
    </ul>
    <button class="btn view-all-fixtures">View All Fixtures</button>
  </div>
</div>

<div class="league-overview">
  <div class="overview-team-of-week">
    <h4>Team of the Week</h4>
    <div class="pitch-container">
      <!-- Player cards will be injected here -->
    </div>
  </div>
  <div class="league-table-container">
    <!-- League Table content will be injected here -->
  </div>
</div>


    </section>

    <!-- Standings -->
    <section id="standings" class="tab-content">
      <h3>Current Standings</h3>
       <div id="error"></div>
  <table>
    <thead>
      <tr>
        <th>Position</th>
        <th>Team</th>
        <th>Points</th>
      </tr>
    </thead>
    <tbody id="standings-body">
      <!-- Data rows will go here -->
    </tbody>
  </table>

    </section>

    <!-- Fixtures -->
    <section id="fixtures" class="tab-content">
      <h3>Upcoming Fixtures</h3>
      <div class="fixtures-list">
        <!-- Fixture cards go here -->

        <p id="no-fixtures" style="display:none; color:#facc15;">No fixtures found for this league in the selected date range.</p>

      </div>
    </section>


    <!-- Statistics -->
   <section id="statistics" class="tab-content">
  <h3>Statistics</h3>

  <div id="top-scorers">
  <ul class="stat-list"></ul>
  <ul id="full-scorers" class="hidden"></ul>
</div>
<div id="top-assists">
  <ul class="stat-list"></ul>
  <ul id="full-assists" class="hidden"></ul>
</div>
<div id="clean-sheets">
  <ul class="stat-list"></ul>
  <ul id="full-cleansheets" class="hidden"></ul>
</div>

</section>


    <!-- News -->
    <section id="news" class="tab-content">
      <h3>Latest League News</h3>
      <div class="news-grid">
        <!-- News cards here -->
      </div>
      <button class="view-more-news">View More News</button>
    </section>


    
  </main>
<!-- ⚫ FOOTER -->
  <footer class="site-footer">
    <div class="container">
      <p>&copy; 2025 FootWire. All rights reserved.</p>
      <ul class="footer-links">
        <li><a href="">Privacy</a></li>
        <li><a href="">Terms</a></li>
        <li><a href="">Contact</a></li>
      </ul>
      <ul class="social-icons">
        <li><a href=""><img src="icons/x.svg" alt="Twitter/X"></a></li>
        <li><a href=""><img src="icons/instagram.svg" alt="Instagram"></a></li>
        <li><a href=""><img src="icons/youtube.svg" alt="YouTube"></a></li>
      </ul>
    </div>
  </footer>
  <script>
  // Europe’s Top 5 Leagues Data
const leagues = [
  {
    id: 1,
    name: 'Premier League',
    logo: 'images/premier-league-logo-5F922E3/premier-league-logo.png',
    description: 'England’s top-flight competition featuring 20 clubs battling for glory.',
    fixtures: [
      {
        home: 'Arsenal',
        away: 'Man City',
        time: '18:30',
        homeLogo: 'images/logos/arsenal.png',
        awayLogo: 'images/logos/mancity.png',
        link: 'match.html?id=1001'
      },
      {
        home: 'Liverpool',
        away: 'Chelsea',
        time: '21:00',
        homeLogo: 'images/logos/liverpool.png',
        awayLogo: 'images/logos/chelsea.png',
        link: 'match.html?id=1002'
      },
      {
        home: 'Newcastle',
        away: 'Tottenham',
        time: '16:00',
        homeLogo: 'images/logos/newcastle.png',
        awayLogo: 'images/logos/tottenham.png',
        link: 'match.html?id=1003'
      },
    ],
     teamOfWeek: [
      { name: 'Alisson', position: 'GK', rating: 7.8, img: 'images/players/alisson.png' },
      { name: 'Trent Alexander-Arnold', position: 'RB', rating: 8.2, img: 'images/players/trent.png' },
      { name: 'Virgil van Dijk', position: 'CB', rating: 8.5, img: 'images/players/vandijk.png' },
      { name: 'Saliba', position: 'CB', rating: 8.0, img: 'images/players/rudiger.png' },
      { name: 'Luke Shaw', position: 'LB', rating: 8.1, img: 'images/players/cancelo.png' },
      { name: 'Kevin De Bruyne', position: 'CM', rating: 8.7, img: 'images/players/debruyne.png' },
      { name: 'Bruno Fernandes', position: 'CM', rating: 8.3, img: 'images/players/fernandes.png' },
      { name: 'Maddison', position: 'CM', rating: 8.4, img: 'images/players/modric.png' },
      { name: 'Mohamed Salah', position: 'RW', rating: 8.6, img: 'images/players/salah.png' },
      { name: 'Erling Haaland', position: 'ST', rating: 8.9, img: 'images/players/haaland.png' },
      { name: 'Bukayo Saka', position: 'LW', rating: 8.2, img: 'images/players/saka.png' }
    ],
    seasonId:'23690',
    league_id:'501',
  },
  {
    id: 2,
    name: 'La Liga',
    logo: 'images/La_Liga-2023-brandlogos.net-OBnr7x/la_liga-logo_brandlogos.net_e6gnt.png',
    description: 'Spain’s premier professional football division with fierce rivalries.',
     fixtures: [
      {
        home: 'Real Madrid',
        away: 'Barcelona',
        time: '18:30',
        homeLogo: 'images/logos/arsenal.png',
        awayLogo: 'images/logos/mancity.png',
        link: 'match.html?id=2001'
      },
    
    ],
    teamOfWeek: [
      { name: 'Jan Oblak', position: 'GK', rating: 8.0, img: 'images/players/oblak.png' },
      { name: 'Dani Carvajal', position: 'RB', rating: 8.1, img: 'images/players/carvajal.png' },
      { name: 'Éder Militão', position: 'CB', rating: 8.3, img: 'images/players/militao.png' },
      { name: 'Asensio', position: 'CB', rating: 8.0, img: 'images/players/ramos.png' },
      { name: 'Jordi Alba', position: 'LB', rating: 8.2, img: 'images/players/alba.png' },
      { name: 'Jude Bellingham', position: 'CM', rating: 8.4, img: 'images/players/kroos.png' },
      { name: 'Frenkie de Jong', position: 'CM', rating: 8.3, img: 'images/players/dejong.png' },
      { name: 'Pedri', position: 'CM', rating: 8.1, img: 'images/players/pedri.png' },
      { name: 'Mbappe', position: 'ST', rating: 8.5, img: 'images/players/benzema.png' },
      { name: 'Yamal', position: 'LW', rating: 8.0, img: 'images/players/fati.png' },
      { name: 'Vinícius Júnior', position: 'RW', rating: 8.2, img: 'images/players/vini.png' }
    ],
     seasonId:'23584',
     league_id:'271',
  },
  {
    id: 3,
    name: 'Serie A',
    logo: 'images/serie-a-logo.png',
    description: 'Italy’s most prestigious football league, home to legendary clubs.',
     fixtures: [
      {
        home: 'Juventus',
        away: 'AC Milan',
        time: '18:30',
        homeLogo: 'images/logos/arsenal.png',
        awayLogo: 'images/logos/mancity.png',
        link: 'match.html?id=3001'
      },
     
    ]
  },
  {
    id: 4,
    name: 'Bundesliga',
    logo: 'images/bundesliga-logo.png',
    description: 'Germany’s top professional football league known for passionate fans.',
     fixtures: [
      {
        home: 'Bayern Munich',
        away: 'Dortmund',
        time: '18:30',
        homeLogo: 'images/logos/arsenal.png',
        awayLogo: 'images/logos/mancity.png',
        link: 'match.html?id=4001'
      },
      
    ]
  },
  {
    id: 5,
    name: 'Ligue 1',
    logo: 'images/ligue-1-logo.png',
    description: 'France’s elite football division showcasing world-class talent.',
     fixtures: [
      {
        home: 'PSG',
        away: 'Marseille',
        time: '18:30',
        homeLogo: 'images/logos/arsenal.png',
        awayLogo: 'images/logos/mancity.png',
        link: 'match.html?id=5001'
      },
    ]
  }
];

// Get league ID from URL param (as number string)
const urlParams = new URLSearchParams(window.location.search);
const leagueNumId = urlParams.get('id');

// Convert to number and find corresponding league by array index (subtract 1 since arrays are 0-based)
const selectedLeague = leagues[leagueNumId - 1] || leagues[0]; // fallback to first (Premier League)

// If found, update page content dynamically
if (selectedLeague) {
  document.title = `FootWire | ${selectedLeague.name} Overview`;
  document.querySelector('.site-header h1').textContent = `FootWire ⚽ ${selectedLeague.name}`;
  document.querySelector('.league-logo').src = selectedLeague.logo;
  document.querySelector('.league-logo').alt = `${selectedLeague.name} Logo`;
  document.querySelector('.league-info h2').textContent = selectedLeague.name;
  document.querySelector('.league-description').textContent = selectedLeague.description;
}

// MAIN TAB SWITCHING
const tabButtons = document.querySelectorAll('.tab-btn');
const tabContents = document.querySelectorAll('.tab-content');

tabButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    tabButtons.forEach(b => b.classList.remove('active'));
    tabContents.forEach(c => c.classList.remove('active'));
    btn.classList.add('active');
    document.getElementById(btn.dataset.tab).classList.add('active');
    btn.scrollIntoView({ behavior: 'smooth', inline: 'center' });
  });
});

// SUB-TAB SWITCHING (inside Statistics)
const subTabButtons = document.querySelectorAll('.sub-tab');
const subTabContents = document.querySelectorAll('.sub-tab-content');

subTabButtons.forEach(st => {
  st.addEventListener('click', () => {
    subTabButtons.forEach(b => b.classList.remove('active'));
    subTabContents.forEach(c => c.classList.remove('active'));
    st.classList.add('active');
    document.getElementById(st.dataset.subtab).classList.add('active');
  });
});

// VIEW MORE / VIEW LESS TOGGLE FOR STAT LISTS
const viewMoreButtons = document.querySelectorAll('.view-more');

viewMoreButtons.forEach(button => {
  button.addEventListener('click', () => {
    const targetList = document.getElementById(button.dataset.target);
    const isHidden = targetList.classList.toggle('hidden');
    button.textContent = isHidden ? 'View More' : 'View Less';
    if (!isHidden) {
      targetList.scrollIntoView({ behavior: 'smooth' });
    }
  });
});

// video 
const weeklyNewsVideos = {
  1: 'https://www.youtube.com/embed/https://youtu.be/XYoMhLSd3Ww?si=e_AmEjPWuONVtwQd',
  2: 'https://www.youtube.com/embed/https://youtu.be/dz8uxFVRgrA?si=WouOZ-OPiPOMAH_k',
  // …other leagues…
};

const overviewVideoContainer = document.querySelector('#overview .video-container');
const leagueKey = selectedLeague.id; // from our league.js code above
const videoURL = weeklyNewsVideos[leagueKey] || weeklyNewsVideos['premier-league'];

overviewVideoContainer.innerHTML = `
  <iframe
    src="${videoURL}"
    frameborder="0"
    allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
    allowfullscreen
  ></iframe>
`;

// fixtures
const fixturesPreview = document.querySelector('.fixtures-preview');
fixturesPreview.innerHTML = '';

(selectedLeague.fixtures || []).slice(0, 3).forEach(fx => {
  const a = document.createElement('a');
  a.href = fx.link;
  a.className = 'fixture-item';

  a.innerHTML = `
    <img src="${fx.homeLogo}" alt="${fx.home} logo" class="fixture-logo">
    <span class="fixture-text">${fx.home} vs ${fx.away} — ${fx.time}</span>
    <img src="${fx.awayLogo}" alt="${fx.away} logo" class="fixture-logo">
  `;

  fixturesPreview.appendChild(a);
});

// --- Team of the Week ---


// position mapping
const formationPositions = {
  GK: { top: 90, left: 50 },
  LB: { top: 70, left: 15 },
  CB: [
    { top: 70, left: 40 },
    { top: 70, left: 60 }
  ],
  RB: { top: 70, left: 85 },
  CM: [
    { top: 50, left: 25 },
    { top: 50, left: 50 },
    { top: 50, left: 75 }
  ],
  LW: { top: 30, left: 20 },
  ST: { top: 30, left: 50 },
  RW: { top: 30, left: 80 }
};



const pitchContainer = document.querySelector('.pitch-container');
const positionCounters = {}; // To handle multiple players in the same position

selectedLeague.teamOfWeek.forEach(player => {
  const pos = player.position;
  let coords;

  if (Array.isArray(formationPositions[pos])) {
    // Initialize counter if not present
    if (!positionCounters[pos]) positionCounters[pos] = 0;
    // Assign coordinates based on the counter
    coords = formationPositions[pos][positionCounters[pos]];
    positionCounters[pos]++;
  } else {
    coords = formationPositions[pos];
  }

  if (!coords) return; // Skip if position is undefined

  // Create player card element
  const playerCard = document.createElement('a');
  playerCard.href = `player.html?id=${encodeURIComponent(player.name.toLowerCase().replace(/\s+/g, '-'))}`;
  playerCard.className = 'player-card';
  playerCard.style.top = `${coords.top}%`;
  playerCard.style.left = `${coords.left}%`;

  playerCard.innerHTML = `
    <img src="${player.img}" alt="${player.name}" class="player-img">
    <span class="player-rating">${player.rating.toFixed(1)}</span>
  `;

  pitchContainer.appendChild(playerCard);
});



//table
// Function to extract the 'id' parameter from the URL
function getLeagueIdFromURL() {
  const params = new URLSearchParams(window.location.search);
  const idParam = params.get('id');
  return idParam ? parseInt(idParam, 10) : null;
}

function renderLeagueTable(leagueId) {
  const league = leagues.find(l => l.id === leagueId);
  if (!league || !league.seasonId) return;

  const seasonId = league.seasonId;
  const tableContainer = document.querySelector('.league-table-container');
  tableContainer.innerHTML = `<p>Loading standings for ${league.name}...</p>`;

  fetch(`http://localhost:3000/api/standings/${seasonId}`)
    .then(response => {
      if (!response.ok) throw new Error('Failed to fetch standings');
      return response.json();
    })
    .then(data => {
      if (!data.data || data.data.length === 0) {
        tableContainer.innerHTML = '<p>No standings data found.</p>';
        return;
      }

      // Limit to top half of table
      const standings = data.data.slice(0, Math.ceil(data.data.length / 2));

      const tableHTML = `
        <h2>${league.name} Standings</h2>
        <table>
          <thead>
            <tr>
              <th>Pos</th>
              <th>Team</th>
              <th>Pts</th>
            </tr>
          </thead>
          <tbody>
            ${standings.map(team => `
              <tr>
                <td>${team.position}</td>
                <td>
                  <img src="${team.participant.image_path}" alt="${team.participant.name}" class="team-logo" />
                  ${team.participant.name}
                </td>
                <td>${team.points}</td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      `;

      tableContainer.innerHTML = tableHTML;
    })
    .catch(err => {
      console.error('Error:', err);
      tableContainer.innerHTML = `<p>Error loading standings.</p>`;
    });
}

const leagueId = parseInt(urlParams.get('id'));
renderLeagueTable(leagueId);


// testing api
if (!leagueNumId) {
  document.getElementById('error').textContent = 'No league ID provided in URL.';
} else {
  const selectedLeague = leagues.find(l => l.id.toString() === leagueNumId);

  if (!selectedLeague) {
    document.getElementById('error').textContent = 'League not found.';
  } else {
    const seasonId = selectedLeague.seasonId;

    fetch(`http://localhost:3000/api/standings/${seasonId}`)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(data => {
        const standingsBody = document.getElementById('standings-body');
        standingsBody.innerHTML = ''; 

        if (!data.data || data.data.length === 0) {
          document.getElementById('error').textContent = 'No standings data found.';
          return;
        }

        data.data.forEach(team => {
          const row = document.createElement('tr');

          const positionCell = document.createElement('td');
          positionCell.textContent = team.position;
          row.appendChild(positionCell);

          const teamCell = document.createElement('td');
          const teamImg = document.createElement('img');
          teamImg.src = team.participant.image_path;
          teamImg.alt = team.participant.name;
          teamImg.className = 'team-logo';
          teamCell.appendChild(teamImg);
          teamCell.appendChild(document.createTextNode(' ' + team.participant.name));
          row.appendChild(teamCell);

          const pointsCell = document.createElement('td');
          pointsCell.textContent = team.points;
          row.appendChild(pointsCell);

          standingsBody.appendChild(row);
        });
      })
      .catch(error => {
        console.error('Error fetching standings:', error);
        document.getElementById('error').textContent = 'Failed to load standings data.';
      });
  }
}

// fixtures api

function renderFixtures(fixtures) {
  const container = document.querySelector('.fixtures-list');
  container.innerHTML = '';

  fixtures.forEach(fixture => {
    const div = document.createElement('div');
    div.className = 'fixture';

    const participants = fixture.participants || [];

    let home, away;
    if (participants.length === 2 && participants[0].meta && participants[1].meta) {
      home = participants.find(p => p.meta.location === 'home');
      away = participants.find(p => p.meta.location === 'away');
    }
    if (!home || !away) {
      home = participants[0];
      away = participants[1];
    }

    const homeName = home?.name || 'TBD';
    const awayName = away?.name || 'TBD';

    const homeLogo = home?.image_path
      ? `<img src="${home.image_path}" alt="${homeName}" style="height: 30px; vertical-align: middle;">`
      : '';
    const awayLogo = away?.image_path
      ? `<img src="${away.image_path}" alt="${awayName}" style="height: 30px; vertical-align: middle;">`
      : '';

    const kickoff = new Date(fixture.starting_at).toLocaleString();

    const currentScores = fixture.scores?.filter(s => s.description === 'CURRENT') || [];

    const homeScoreObj = currentScores.find(s => s.participant_id === home?.id);
    const awayScoreObj = currentScores.find(s => s.participant_id === away?.id);

    const homeScore = homeScoreObj?.score?.goals ?? '-';
    const awayScore = awayScoreObj?.score?.goals ?? '-';

    div.innerHTML = `
      <div>
        ${homeLogo} <strong>${homeName}</strong>
        <span style="font-size:18px; color:#facc15;">${homeScore}</span>
        -
        <span style="font-size:18px; color:#facc15;">${awayScore}</span>
        ${awayLogo} <strong>${awayName}</strong>
      </div>
      <em>${kickoff}</em>
    `;

    container.appendChild(div);
  });
}



// Run when page loads
window.addEventListener('DOMContentLoaded', fetchLeagueFixtures);
  </script>
</body>
</html>
